#!/usr/bin/env bash
# install_julia $ASDF_INSTALL_VERSION $ASDF_INSTALL_PATH
# ASDF_INSTALL_VERSION="0.5.0"
# ASDF_INSTALL_PATH=$PWD
# version_zero_check=${ASDF_INSTALL_VERSION##*.}
# if [ $version_zero_check -eq 0 ];
#     then version_trim=${ASDF_INSTALL_VERSION%.0};
# else version_trim=$ASDF_INSTALL_VERSION;
# fi
version_trim=${ASDF_INSTALL_VERSION%.*}
url="https://julialang.s3.amazonaws.com/bin/linux/x64/$version_trim/julia-$ASDF_INSTALL_VERSION-linux-x86_64.tar.gz"
tmp_download_dir="$(mktemp -d -t asdf-julia.XXX)"
curl $url --create-dirs -so "$tmp_download_dir/julia.tar.gz"
export output_dir="$(tar -xvf "$tmp_download_dir/julia.tar.gz" -C "$ASDF_INSTALL_PATH")" 
export install_dir="$(echo $output_dir | cut -f1 -d"/")"
export julia_dir=${install_dir%-*}
echo $ASDF_INSTALL_PATH
echo "$output_dir"
echo "$install_dir"
echo "$julia_dir"
mv $ASDF_INSTALL_PATH/$install_dir $ASDF_INSTALL_PATH/$julia_dir
if [[ -z "$CI_SERVER" ]]; then
    echo "Do you want to install the desktop entry for Julia (y/n)?"
    read installdesktop
    if [ $installdesktop == "y" ]; then
        cp $ASDF_INSTALL_PATH/$julia_dir/share/applications/julia.desktop $HOME/.local/share/applications/julia.desktop
    fi
    # cp $ASDF_INSTALL_PATH/$julia_dir/share/applications/julia.desktop $HOME/.local/share/applications/julia.desktop;
fi

# cp -r $tmp_download_dir/julia $ASDF_INSTALL_PATH
rm -rf $tmp_download_dir
